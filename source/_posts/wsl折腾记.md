---
title: wsl折腾记
date: 2024-06-14 13:00:40
tags: 折腾记
---

##  WSL ---- 折腾日记

好吧，这次折腾是一次完完全全的不必要的折腾了，因为早在将近一个月之前，在无意间点开了学习 **CMAKE**的一个视频，又燃起了我想要自从大一上最后看到cs50里的优雅的vscode调试和编译运行功能，特别是在vscode上的调试，一直萦绕在我的心头，好像成为了一个想要解决的但是却无法很好解决的心病。但当我了解到了**Make**，**CMAKE**，是何物之后，那段时间便打开了我的Linux大门，没错，在黑色的终端上敲命令，才符合我对***计算机高手***的印象嘛。也算是另一种方式的，拯救小时候的自己的体现了。好的那段时间，学习windows下CMKE的打包项目编译，Linux下的Make命令，也算的上是另两种的简单语言了吧。接着，今天的主角也就登场了，写下这篇文章就是为了记录他，记录他的光辉。

### **WSL**

wsl(Windows subsystem Linux)是微软为windows开发的一个能够将Linux的任意发行版作为windows子系统的一项虚拟技术，至少wsl2是会使用到Hyper-v的虚拟机技术。wsl2的内核是<a href="https://gitcode.com/microsoft/WSL2-Linux-Kernel/tree/linux-msft-wsl-5.15.y/Documentation">开源</a>的。更详细的[博客文章](https://blog.csdn.net/weixin_45027467/article/details/106862520)。当然微软的官方文档都有啦。要写的就是一些跟着文档做但是却做不明白的东西。

#### wsl的安装

说是安装，其实就是打开windows中自带的没有开启的两个功能，功能打开之后，**重启电脑**，就相当于安装好wsl了。这时可以在powershell终端中输入wsl查看，是否已经打开（安装好）wsl。

必须使用管理员权限打开powershell，开启这两个功能：

```shell
# 打开Linux的windows子系统
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
# 打开虚拟机平台（WSL2）
dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart

```

 安装完毕之后就是要安装你想要的Linux发行版本了，这里最稳定且最有效的安装方法就是在Microsoft Store里找到ubuntu的发行版进行下载，当下载完毕之后就可以使用powershell，输入```wsl```指令查看是否安装成功，且wsl识别到了。这里还要注意的是，wsl可能会有很多个可用的发行版本，其中有一个默认的打开的发行版本。```wsl --list```列出所有安装了的发行版本，```wsl --setdefault "version-name"```这样就可以选择默认的发行版本，并且默认打开是ubuntu了。

这样一来wsl就算是安装成功了。

#### wsl的卸载

wsl的卸载和安装同理。只需要禁用打开的两个功能，这时就达到了卸载的效果（至少现在看来是这样的）。

```shell
# 禁用WSL子系统功能。
Disable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux

```

但是非常注意C盘空间的你注意了，此时只是禁用了wsl，但安装的Linux发行版本还是存储在硬盘内部，所以需要有一步注销发行版本的操作。

````
wsl --unregister <distribution name>
````

注销掉所有的wsl内部的Linux发行版本，此时就算是大功告成了吧。

### WSL&vscode

配合上docker的使用（虽然我现在还是完全没有上手的docker），wsl和vscode就可以（好像也不需要docker），反正当安装好wsl之后点击vscode左下角的远程链接按钮就会有提示```connect to wsl```，点击链接到wsl之后，就可以看到左下角出现了```wsl:ubuntu()```的字样，这时就处在linux系统之中了，就可以快乐的使用linux终端了！

#### DEBUG

再wsl+vscode的调试环境内，想要调试编译C++文件，首先就要在这个wsl的vscode的workspace中下载好c++的插件，当插件下载好后，点击调试，这时就会让你选择特定的配置文件进行调试，这个时候要选择插件蹦出来的那几款配置文件！点击之后就会自动生成，特定的```launch.json```和```task.json```，注意不知道从最近的哪一年，vscode更新之后，就不会自动生成```launch.json```文件了，所以这个时候```launch.json```，反而好像并没有什么用。

```launch.json```

```json
{
    // Use IntelliSense to learn about possible attributes.
    // Hover to view descriptions of existing attributes.
    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
    "version": "0.2.0",
    "configurations": []
}
```



```task.json```

```json
{
    "tasks": [
        {
            "type": "cppbuild",
            "label": "C/C++: gcc-11 build active file",
            "command": "/usr/bin/gcc-11",
            "args": [
                "-fdiagnostics-color=always",
                "-g",
                "${file}",
                "-o",
                "${fileDirname}/main"
            ],
            "options": {
                "cwd": "${fileDirname}"
            },
            "problemMatcher": [
                "$gcc"
            ],
            "group": "build",
            "detail": "Task generated by Debugger."
        },
        {
            "type": "cppbuild",
            "label": "C/C++: g++ build active file",
            "command": "/usr/bin/g++",
            "args": [
                "-fdiagnostics-color=always",
                "-g",
                "${file}",
                "-o",
                "${fileDirname}/${fileBasenameNoExtension}"
            ],
            "options": {
                "cwd": "${fileDirname}"
            },
            "problemMatcher": [
                "$gcc"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "detail": "compiler: /usr/bin/g++"
        }
    ],
    "version": "2.0.0"
}
```

还有最重要的，调试配置成功的最重要的一步就是，要设置cpp插件的```compile-path```,也就是要告诉他，系统的```gcc g++```编译器的位置，具体的UI界面是在[这里](https://www.jianshu.com/p/4f3f9e65dca6)，配置文件：

```c_cpp_properties.json```

```json
{
    "configurations": [
        {
            "name": "Linux",
            "includePath": [
                "${workspaceFolder}/**"
            ],
            "defines": [],
            "cStandard": "c99",
            "cppStandard": "gnu++17",
            "intelliSenseMode": "linux-gcc-x64",
            "compilerPath": "/usr/bin/g++"
        }
    ],
    "version": 4
}
```

这样设置完成之后，加上断点，就大功告成了。

2024-06-14 19：22：刚刚看了我的博客网站渲染的代码模块，也太丑了，暑假一定换。
